import pickle
import random
import time

import numpy as np
from settings import *
from plots_lib import *
from tensorflow.keras.callbacks import TensorBoard, EarlyStopping
from sklearn.utils import shuffle
from tensorflow.keras.layers import Dense, Activation, Flatten, Conv2D, MaxPooling2D, Dropout
from tensorflow.keras.models import Sequential

# tensorboard --logdir="logs"

X_test = np.array(pickle.load(open(X_TEST_PICKLED, "rb")))
y_test = np.array(pickle.load(open(Y_TEST_PICKLED, "rb")))

X_val = np.array(pickle.load(open(X_VAL_PICKLED, "rb")))
y_val = np.array(pickle.load(open(Y_VAL_PICKLED, "rb")))

X_train = np.array(pickle.load(open(X_TRAIN_PICKLED, "rb")))
y_train = np.array(pickle.load(open(Y_TRAIN_PICKLED, "rb")))

categories_number = len(np.unique(y_train))
print(f"Number of categories: {categories_number}")
print(f"Number of all training images: {len(y_train)}")
print('Training dataset shape')
print(X_train.shape)

X_train, y_train = shuffle(X_train, y_train)
X_val, y_val = shuffle(X_val, y_val)

X_train = X_train / 255.0
X_val = X_val / 255.0
X_test = X_test / 255.0

epochs = 20
history_array = []
names_array = []

NAME = f"{int(time.time())}-rgb-road_signs_recognition-conv-{'32x32x64x128'}-sigmoid"
print(NAME)

tensorboard = TensorBoard(log_dir=f'../logs/{NAME}')
early_stopping = EarlyStopping(monitor='val_loss', min_delta=1e-2, patience=2, verbose=1)

for i in range(5):

    model = Sequential()

    model.add(Conv2D(32, (5, 5), input_shape=X_train.shape[1:], padding='Same'))
    model.add(Activation("relu"))
    model.add(Conv2D(32, (5, 5)))
    model.add(Activation("relu"))

    model.add(MaxPooling2D(pool_size=(2, 2)))

    model.add(Dropout(0.25))

    model.add(Conv2D(64, (3, 3)))
    model.add(Activation("relu"))
    model.add(Conv2D(128, (3, 3)))
    model.add(Activation("relu"))

    model.add(Dropout(0.25))

    model.add(MaxPooling2D(pool_size=(2, 2)))

    model.add(Flatten())

    model.add(Dense(categories_number))
    model.add(Activation("sigmoid"))

    loss_function = "sparse_categorical_crossentropy"
    optimizer = "adam"
    metric = "sparse_categorical_accuracy"

    model.compile(loss=loss_function,
                  optimizer=optimizer,
                  metrics=[metric])

    history = model.fit(X_train, y_train, validation_data=(X_val, y_val),
                        batch_size=64, epochs=epochs,
                        callbacks=[early_stopping, tensorboard]
                        )
    history_array.append(history)
    names_array.append(f"SieÄ‡ 32x32x64x128 {i}")
    model.summary()

    print('\n# Evaluate on test data')
    results = model.evaluate(X_test, y_test)
    print('test loss, test acc:', results)

    model.save(f"../saved_models/{NAME}.model")

    plot_accuracy_history(history, metric, f'acc_{NAME}')
    plot_loss_history(history, loss_function, f'loss_{NAME}')

plot_multi_val_accuracy(history_array, names_array, "sparse_categorical_accuracy",
                        'acc_5_rgb_conv_network')
plot_multi_val_loss(history_array, names_array,
                    'val_5_rgb_conv_network')

# /home/piotr/Dokumenty/inzynierka/road_signs_recognition_system/venv/bin/python /home/piotr/Dokumenty/inzynierka/road_signs_recognition_system/src/rgb_conv_network.py
# Number of categories: 19
# Number of all training images: 95084
# Training dataset shape
# (95084, 32, 32, 3)
# [ 0  0  0 ... 18 18 18]
# [17  4 18 ... 11  8  0]
# 1578625357-rgb-road_signs_recognition-conv-32(3,3)2x2-dense-0-epochs-10
# Train on 95084 samples, validate on 28587 samples
# Epoch 1/10
# 95084/95084 [==============================] - 53s 559us/sample - loss: 0.5651 - sparse_categorical_accuracy: 0.8362 - val_loss: 0.2991 - val_sparse_categorical_accuracy: 0.9122
# Epoch 2/10
# 95084/95084 [==============================] - 52s 546us/sample - loss: 0.1795 - sparse_categorical_accuracy: 0.9497 - val_loss: 0.2521 - val_sparse_categorical_accuracy: 0.9249
# Epoch 3/10
# 95084/95084 [==============================] - 53s 555us/sample - loss: 0.1233 - sparse_categorical_accuracy: 0.9653 - val_loss: 0.2026 - val_sparse_categorical_accuracy: 0.9414
# Epoch 4/10
# 95084/95084 [==============================] - 56s 588us/sample - loss: 0.0916 - sparse_categorical_accuracy: 0.9732 - val_loss: 0.2308 - val_sparse_categorical_accuracy: 0.9341
# Epoch 5/10
# 95084/95084 [==============================] - 53s 559us/sample - loss: 0.0746 - sparse_categorical_accuracy: 0.9777 - val_loss: 0.1879 - val_sparse_categorical_accuracy: 0.9466
# Epoch 6/10
# 95084/95084 [==============================] - 52s 550us/sample - loss: 0.0611 - sparse_categorical_accuracy: 0.9816 - val_loss: 0.2055 - val_sparse_categorical_accuracy: 0.9479
# Epoch 7/10
# 95084/95084 [==============================] - 53s 559us/sample - loss: 0.0530 - sparse_categorical_accuracy: 0.9842 - val_loss: 0.1988 - val_sparse_categorical_accuracy: 0.9506
# Epoch 00007: early stopping
# Model: "sequential"
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #
# =================================================================
# conv2d (Conv2D)              (None, 30, 30, 32)        896
# _________________________________________________________________
# activation (Activation)      (None, 30, 30, 32)        0
# _________________________________________________________________
# max_pooling2d (MaxPooling2D) (None, 15, 15, 32)        0
# _________________________________________________________________
# conv2d_1 (Conv2D)            (None, 13, 13, 64)        18496
# _________________________________________________________________
# activation_1 (Activation)    (None, 13, 13, 64)        0
# _________________________________________________________________
# max_pooling2d_1 (MaxPooling2 (None, 6, 6, 64)          0
# _________________________________________________________________
# flatten (Flatten)            (None, 2304)              0
# _________________________________________________________________
# dense (Dense)                (None, 19)                43795
# _________________________________________________________________
# activation_2 (Activation)    (None, 19)                0
# =================================================================
# Total params: 63,187
# Trainable params: 63,187
# Non-trainable params: 0
# _________________________________________________________________
#
# # Evaluate on test data
# 1216/1 [==============] - 0s 227us/sample - loss: 0.6277 - sparse_categorical_accuracy: 0.9104
# test loss, test acc: [0.5540145948374043, 0.9103618]
#


# 1578704947-rgb-road_signs_recognition-conv-32x32x64x64-dense-256-softmax
# Train on 95084 samples, validate on 28587 samples
# Epoch 1/20
# 95084/95084 [==============================] - 326s 3ms/sample - loss: 0.6696 - sparse_categorical_accuracy: 0.7852 - val_loss: 0.2154 - val_sparse_categorical_accuracy: 0.9356
# Epoch 2/20
# 95084/95084 [==============================] - 309s 3ms/sample - loss: 0.1963 - sparse_categorical_accuracy: 0.9383 - val_loss: 0.1522 - val_sparse_categorical_accuracy: 0.9489
# Epoch 3/20
# 95084/95084 [==============================] - 306s 3ms/sample - loss: 0.1460 - sparse_categorical_accuracy: 0.9538 - val_loss: 0.1235 - val_sparse_categorical_accuracy: 0.9619
# Epoch 4/20
# 95084/95084 [==============================] - 318s 3ms/sample - loss: 0.1183 - sparse_categorical_accuracy: 0.9626 - val_loss: 0.1253 - val_sparse_categorical_accuracy: 0.9622
# Epoch 5/20
# 95084/95084 [==============================] - 308s 3ms/sample - loss: 0.1030 - sparse_categorical_accuracy: 0.9676 - val_loss: 0.1175 - val_sparse_categorical_accuracy: 0.9634
# Epoch 00005: early stopping
# Model: "sequential"
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #
# =================================================================
# conv2d (Conv2D)              (None, 32, 32, 32)        2432
# _________________________________________________________________
# activation (Activation)      (None, 32, 32, 32)        0
# _________________________________________________________________
# conv2d_1 (Conv2D)            (None, 28, 28, 32)        25632
# _________________________________________________________________
# activation_1 (Activation)    (None, 28, 28, 32)        0
# _________________________________________________________________
# max_pooling2d (MaxPooling2D) (None, 14, 14, 32)        0
# _________________________________________________________________
# dropout (Dropout)            (None, 14, 14, 32)        0
# _________________________________________________________________
# conv2d_2 (Conv2D)            (None, 12, 12, 64)        18496
# _________________________________________________________________
# conv2d_3 (Conv2D)            (None, 10, 10, 64)        36928
# _________________________________________________________________
# activation_2 (Activation)    (None, 10, 10, 64)        0
# _________________________________________________________________
# max_pooling2d_1 (MaxPooling2 (None, 5, 5, 64)          0
# _________________________________________________________________
# dropout_1 (Dropout)          (None, 5, 5, 64)          0
# _________________________________________________________________
# flatten (Flatten)            (None, 1600)              0
# _________________________________________________________________
# dense (Dense)                (None, 256)               409856
# _________________________________________________________________
# dropout_2 (Dropout)          (None, 256)               0
# _________________________________________________________________
# dense_1 (Dense)              (None, 19)                4883
# _________________________________________________________________
# activation_3 (Activation)    (None, 19)                0
# =================================================================
# Total params: 498,227
# Trainable params: 498,227
# Non-trainable params: 0
# _________________________________________________________________
#
# # Evaluate on test data
# 1216/1 [=============================] - 1s 677us/sample - loss: 0.0962 - sparse_categorical_accuracy: 0.9490
# test loss, test acc: [0.1923692737196628, 0.9490132]


# 1578706709-rgb-road_signs_recognition-conv-32x32x64x64-softmax
# Train on 95084 samples, validate on 28587 samples
# Epoch 1/20
# 95084/95084 [==============================] - 330s 3ms/sample - loss: 0.6216 - sparse_categorical_accuracy: 0.8063 - val_loss: 0.2535 - val_sparse_categorical_accuracy: 0.9202
# Epoch 2/20
# 95084/95084 [==============================] - 326s 3ms/sample - loss: 0.1850 - sparse_categorical_accuracy: 0.9428 - val_loss: 0.1842 - val_sparse_categorical_accuracy: 0.9419
# Epoch 3/20
# 95084/95084 [==============================] - 317s 3ms/sample - loss: 0.1316 - sparse_categorical_accuracy: 0.9591 - val_loss: 0.1509 - val_sparse_categorical_accuracy: 0.9533
# Epoch 4/20
# 95084/95084 [==============================] - 320s 3ms/sample - loss: 0.1059 - sparse_categorical_accuracy: 0.9666 - val_loss: 0.1696 - val_sparse_categorical_accuracy: 0.9487
# Epoch 5/20
# 95084/95084 [==============================] - 319s 3ms/sample - loss: 0.0899 - sparse_categorical_accuracy: 0.9712 - val_loss: 0.1318 - val_sparse_categorical_accuracy: 0.9577
# Epoch 6/20
# 95084/95084 [==============================] - 329s 3ms/sample - loss: 0.0838 - sparse_categorical_accuracy: 0.9730 - val_loss: 0.1362 - val_sparse_categorical_accuracy: 0.9577
# Epoch 7/20
# 95084/95084 [==============================] - 327s 3ms/sample - loss: 0.0741 - sparse_categorical_accuracy: 0.9758 - val_loss: 0.1062 - val_sparse_categorical_accuracy: 0.9660
# Epoch 8/20
# 95084/95084 [==============================] - 324s 3ms/sample - loss: 0.0688 - sparse_categorical_accuracy: 0.9775 - val_loss: 0.1329 - val_sparse_categorical_accuracy: 0.9596
# Epoch 9/20
# 95084/95084 [==============================] - 330s 3ms/sample - loss: 0.0643 - sparse_categorical_accuracy: 0.9790 - val_loss: 0.1300 - val_sparse_categorical_accuracy: 0.9608
# Epoch 00009: early stopping
# Model: "sequential"
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #
# =================================================================
# conv2d (Conv2D)              (None, 32, 32, 32)        2432
# _________________________________________________________________
# activation (Activation)      (None, 32, 32, 32)        0
# _________________________________________________________________
# conv2d_1 (Conv2D)            (None, 28, 28, 32)        25632
# _________________________________________________________________
# activation_1 (Activation)    (None, 28, 28, 32)        0
# _________________________________________________________________
# max_pooling2d (MaxPooling2D) (None, 14, 14, 32)        0
# _________________________________________________________________
# dropout (Dropout)            (None, 14, 14, 32)        0
# _________________________________________________________________
# conv2d_2 (Conv2D)            (None, 12, 12, 64)        18496
# _________________________________________________________________
# conv2d_3 (Conv2D)            (None, 10, 10, 64)        36928
# _________________________________________________________________
# activation_2 (Activation)    (None, 10, 10, 64)        0
# _________________________________________________________________
# max_pooling2d_1 (MaxPooling2 (None, 5, 5, 64)          0
# _________________________________________________________________
# dropout_1 (Dropout)          (None, 5, 5, 64)          0
# _________________________________________________________________
# flatten (Flatten)            (None, 1600)              0
# _________________________________________________________________
# dense (Dense)                (None, 19)                30419
# _________________________________________________________________
# activation_3 (Activation)    (None, 19)                0
# =================================================================
# Total params: 113,907
# Trainable params: 113,907
# Non-trainable params: 0
# _________________________________________________________________
#
# # Evaluate on test data
# 1216/1 [=======================] - 1s 652us/sample - loss: 0.1270 - sparse_categorical_accuracy: 0.9474
# test loss, test acc: [0.25397575894302615, 0.94736844]


#############BEST##################
# Number of categories: 19
# Number of all training images: 95084
# Training dataset shape
# (95084, 32, 32, 3)
# 1578714434-rgb-road_signs_recognition-conv-32x32x64x128-sigmoid
# Train on 95084 samples, validate on 28587 samples
# Epoch 1/20
# 95084/95084 [==============================] - 351s 4ms/sample - loss: 0.3814 - sparse_categorical_accuracy: 0.8805 - val_loss: 0.1972 - val_sparse_categorical_accuracy: 0.9398
# Epoch 2/20
# 95084/95084 [==============================] - 332s 3ms/sample - loss: 0.1267 - sparse_categorical_accuracy: 0.9605 - val_loss: 0.1460 - val_sparse_categorical_accuracy: 0.9570
# Epoch 3/20
# 95084/95084 [==============================] - 331s 3ms/sample - loss: 0.0970 - sparse_categorical_accuracy: 0.9705 - val_loss: 0.1445 - val_sparse_categorical_accuracy: 0.9567
# Epoch 4/20
# 95084/95084 [==============================] - 334s 4ms/sample - loss: 0.0792 - sparse_categorical_accuracy: 0.9756 - val_loss: 0.1266 - val_sparse_categorical_accuracy: 0.9620
# Epoch 5/20
# 95084/95084 [==============================] - 321s 3ms/sample - loss: 0.0724 - sparse_categorical_accuracy: 0.9770 - val_loss: 0.1202 - val_sparse_categorical_accuracy: 0.9627
# Epoch 6/20
# 95084/95084 [==============================] - 316s 3ms/sample - loss: 0.0623 - sparse_categorical_accuracy: 0.9802 - val_loss: 0.1242 - val_sparse_categorical_accuracy: 0.9656
# Epoch 00006: early stopping
# Model: "sequential"
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #
# =================================================================
# conv2d (Conv2D)              (None, 32, 32, 32)        2432
# _________________________________________________________________
# activation (Activation)      (None, 32, 32, 32)        0
# _________________________________________________________________
# conv2d_1 (Conv2D)            (None, 28, 28, 32)        25632
# _________________________________________________________________
# activation_1 (Activation)    (None, 28, 28, 32)        0
# _________________________________________________________________
# max_pooling2d (MaxPooling2D) (None, 14, 14, 32)        0
# _________________________________________________________________
# dropout (Dropout)            (None, 14, 14, 32)        0
# _________________________________________________________________
# conv2d_2 (Conv2D)            (None, 12, 12, 64)        18496
# _________________________________________________________________
# activation_2 (Activation)    (None, 12, 12, 64)        0
# _________________________________________________________________
# conv2d_3 (Conv2D)            (None, 10, 10, 128)       73856
# _________________________________________________________________
# activation_3 (Activation)    (None, 10, 10, 128)       0
# _________________________________________________________________
# dropout_1 (Dropout)          (None, 10, 10, 128)       0
# _________________________________________________________________
# max_pooling2d_1 (MaxPooling2 (None, 5, 5, 128)         0
# _________________________________________________________________
# flatten (Flatten)            (None, 3200)              0
# _________________________________________________________________
# dense (Dense)                (None, 19)                60819
# _________________________________________________________________
# activation_4 (Activation)    (None, 19)                0
# =================================================================
# Total params: 181,235
# Trainable params: 181,235
# Non-trainable params: 0
# _________________________________________________________________
#
# # Evaluate on test data
# 1216/1 [==========] - 1s 623us/sample - loss: 0.3408 - sparse_categorical_accuracy: 0.9704
# test loss, test acc: [0.1302801760369484, 0.97039473]



########### 5 models logs #########
#
# /home/piotr/Dokumenty/inzynierka/road_signs_recognition_system/venv/bin/python /home/piotr/Dokumenty/inzynierka/road_signs_recognition_system/src/rgb_conv_network.py
# Number of categories: 19
# Number of all training images: 95084
# Training dataset shape
# (95084, 32, 32, 3)
# 1578742834-rgb-road_signs_recognition-conv-32x32x64x128-sigmoid
# 2020-01-11 12:40:34.257480: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
# 2020-01-11 12:40:34.276992: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 3192605000 Hz
# 2020-01-11 12:40:34.277373: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x43c9060 executing computations on platform Host. Devices:
# 2020-01-11 12:40:34.277391: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Host, Default Version
# 2020-01-11 12:40:34.472807: W tensorflow/core/framework/cpu_allocator_impl.cc:81] Allocation of 2336784384 exceeds 10% of system memory.
# 2020-01-11 12:40:35.565788: W tensorflow/core/framework/cpu_allocator_impl.cc:81] Allocation of 702554112 exceeds 10% of system memory.
# Train on 95084 samples, validate on 28587 samples
# Epoch 1/20
# 2020-01-11 12:40:36.662286: I tensorflow/core/profiler/lib/profiler_session.cc:184] Profiler session started.
# 95084/95084 [==============================] - 317s 3ms/sample - loss: 0.3606 - sparse_categorical_accuracy: 0.8883 - val_loss: 0.1993 - val_sparse_categorical_accuracy: 0.9373
# Epoch 2/20
# 95084/95084 [==============================] - 319s 3ms/sample - loss: 0.1189 - sparse_categorical_accuracy: 0.9636 - val_loss: 0.1510 - val_sparse_categorical_accuracy: 0.9540
# Epoch 3/20
# 95084/95084 [==============================] - 318s 3ms/sample - loss: 0.0909 - sparse_categorical_accuracy: 0.9712 - val_loss: 0.1264 - val_sparse_categorical_accuracy: 0.9602
# Epoch 4/20
# 95084/95084 [==============================] - 315s 3ms/sample - loss: 0.0758 - sparse_categorical_accuracy: 0.9757 - val_loss: 0.1049 - val_sparse_categorical_accuracy: 0.9669
# Epoch 5/20
# 95084/95084 [==============================] - 316s 3ms/sample - loss: 0.0645 - sparse_categorical_accuracy: 0.9794 - val_loss: 0.1191 - val_sparse_categorical_accuracy: 0.9627
# Epoch 6/20
# 95084/95084 [==============================] - 318s 3ms/sample - loss: 0.0596 - sparse_categorical_accuracy: 0.9806 - val_loss: 0.1176 - val_sparse_categorical_accuracy: 0.9639
# Epoch 00006: early stopping
# Model: "sequential"
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #
# =================================================================
# conv2d (Conv2D)              (None, 32, 32, 32)        2432
# _________________________________________________________________
# activation (Activation)      (None, 32, 32, 32)        0
# _________________________________________________________________
# conv2d_1 (Conv2D)            (None, 28, 28, 32)        25632
# _________________________________________________________________
# activation_1 (Activation)    (None, 28, 28, 32)        0
# _________________________________________________________________
# max_pooling2d (MaxPooling2D) (None, 14, 14, 32)        0
# _________________________________________________________________
# dropout (Dropout)            (None, 14, 14, 32)        0
# _________________________________________________________________
# conv2d_2 (Conv2D)            (None, 12, 12, 64)        18496
# _________________________________________________________________
# activation_2 (Activation)    (None, 12, 12, 64)        0
# _________________________________________________________________
# conv2d_3 (Conv2D)            (None, 10, 10, 128)       73856
# _________________________________________________________________
# activation_3 (Activation)    (None, 10, 10, 128)       0
# _________________________________________________________________
# dropout_1 (Dropout)          (None, 10, 10, 128)       0
# _________________________________________________________________
# max_pooling2d_1 (MaxPooling2 (None, 5, 5, 128)         0
# _________________________________________________________________
# flatten (Flatten)            (None, 3200)              0
# _________________________________________________________________
# dense (Dense)                (None, 19)                60819
# _________________________________________________________________
# activation_4 (Activation)    (None, 19)                0
# =================================================================
# Total params: 181,235
# Trainable params: 181,235
# Non-trainable params: 0
# _________________________________________________________________
#
# # Evaluate on test data
# 1216/1 [================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================] - 1s 620us/sample - loss: 0.1102 - sparse_categorical_accuracy: 0.9515
# test loss, test acc: [0.22036320203626833, 0.95148027]
# 2020-01-11 13:12:21.341637: W tensorflow/python/util/util.cc:299] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.
# WARNING:tensorflow:From /home/piotr/Dokumenty/inzynierka/road_signs_recognition_system/venv/lib/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1781: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
# Instructions for updating:
# If using Keras pass *_constraint arguments to layers.
# 2020-01-11 13:12:22.104961: W tensorflow/core/framework/cpu_allocator_impl.cc:81] Allocation of 2336784384 exceeds 10% of system memory.
# 2020-01-11 13:12:23.193010: W tensorflow/core/framework/cpu_allocator_impl.cc:81] Allocation of 702554112 exceeds 10% of system memory.
# Train on 95084 samples, validate on 28587 samples
# Epoch 1/20
# 95084/95084 [==============================] - 320s 3ms/sample - loss: 0.3901 - sparse_categorical_accuracy: 0.8774 - val_loss: 0.2118 - val_sparse_categorical_accuracy: 0.9378
# Epoch 2/20
# 95084/95084 [==============================] - 317s 3ms/sample - loss: 0.1223 - sparse_categorical_accuracy: 0.9620 - val_loss: 0.1367 - val_sparse_categorical_accuracy: 0.9585
# Epoch 3/20
# 95084/95084 [==============================] - 319s 3ms/sample - loss: 0.0929 - sparse_categorical_accuracy: 0.9711 - val_loss: 0.1101 - val_sparse_categorical_accuracy: 0.9664
# Epoch 4/20
# 95084/95084 [==============================] - 325s 3ms/sample - loss: 0.0739 - sparse_categorical_accuracy: 0.9766 - val_loss: 0.1412 - val_sparse_categorical_accuracy: 0.9564
# Epoch 5/20
# 95084/95084 [==============================] - 318s 3ms/sample - loss: 0.0654 - sparse_categorical_accuracy: 0.9789 - val_loss: 0.1431 - val_sparse_categorical_accuracy: 0.9588
# Epoch 00005: early stopping
# Model: "sequential_1"
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #
# =================================================================
# conv2d_4 (Conv2D)            (None, 32, 32, 32)        2432
# _________________________________________________________________
# activation_5 (Activation)    (None, 32, 32, 32)        0
# _________________________________________________________________
# conv2d_5 (Conv2D)            (None, 28, 28, 32)        25632
# _________________________________________________________________
# activation_6 (Activation)    (None, 28, 28, 32)        0
# _________________________________________________________________
# max_pooling2d_2 (MaxPooling2 (None, 14, 14, 32)        0
# _________________________________________________________________
# dropout_2 (Dropout)          (None, 14, 14, 32)        0
# _________________________________________________________________
# conv2d_6 (Conv2D)            (None, 12, 12, 64)        18496
# _________________________________________________________________
# activation_7 (Activation)    (None, 12, 12, 64)        0
# _________________________________________________________________
# conv2d_7 (Conv2D)            (None, 10, 10, 128)       73856
# _________________________________________________________________
# activation_8 (Activation)    (None, 10, 10, 128)       0
# _________________________________________________________________
# dropout_3 (Dropout)          (None, 10, 10, 128)       0
# _________________________________________________________________
# max_pooling2d_3 (MaxPooling2 (None, 5, 5, 128)         0
# _________________________________________________________________
# flatten_1 (Flatten)          (None, 3200)              0
# _________________________________________________________________
# dense_1 (Dense)              (None, 19)                60819
# _________________________________________________________________
# activation_9 (Activation)    (None, 19)                0
# =================================================================
# Total params: 181,235
# Trainable params: 181,235
# Non-trainable params: 0
# _________________________________________________________________
#
# # Evaluate on test data
# 1216/1 [================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================] - 1s 629us/sample - loss: 0.0678 - sparse_categorical_accuracy: 0.9671
# test loss, test acc: [0.13555687005367345, 0.96710527]
# 2020-01-11 13:39:05.893951: W tensorflow/core/framework/cpu_allocator_impl.cc:81] Allocation of 2336784384 exceeds 10% of system memory.
# Train on 95084 samples, validate on 28587 samples
# Epoch 1/20
# 95084/95084 [==============================] - 319s 3ms/sample - loss: 0.3711 - sparse_categorical_accuracy: 0.8835 - val_loss: 0.1594 - val_sparse_categorical_accuracy: 0.9506
# Epoch 2/20
# 95084/95084 [==============================] - 324s 3ms/sample - loss: 0.1185 - sparse_categorical_accuracy: 0.9633 - val_loss: 0.1433 - val_sparse_categorical_accuracy: 0.9542
# Epoch 3/20
# 95084/95084 [==============================] - 319s 3ms/sample - loss: 0.0892 - sparse_categorical_accuracy: 0.9721 - val_loss: 0.1121 - val_sparse_categorical_accuracy: 0.9653
# Epoch 4/20
# 95084/95084 [==============================] - 315s 3ms/sample - loss: 0.0751 - sparse_categorical_accuracy: 0.9764 - val_loss: 0.1180 - val_sparse_categorical_accuracy: 0.9645
# Epoch 5/20
# 95084/95084 [==============================] - 319s 3ms/sample - loss: 0.0642 - sparse_categorical_accuracy: 0.9797 - val_loss: 0.1151 - val_sparse_categorical_accuracy: 0.9647
# Epoch 00005: early stopping
# Model: "sequential_2"
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #
# =================================================================
# conv2d_8 (Conv2D)            (None, 32, 32, 32)        2432
# _________________________________________________________________
# activation_10 (Activation)   (None, 32, 32, 32)        0
# _________________________________________________________________
# conv2d_9 (Conv2D)            (None, 28, 28, 32)        25632
# _________________________________________________________________
# activation_11 (Activation)   (None, 28, 28, 32)        0
# _________________________________________________________________
# max_pooling2d_4 (MaxPooling2 (None, 14, 14, 32)        0
# _________________________________________________________________
# dropout_4 (Dropout)          (None, 14, 14, 32)        0
# _________________________________________________________________
# conv2d_10 (Conv2D)           (None, 12, 12, 64)        18496
# _________________________________________________________________
# activation_12 (Activation)   (None, 12, 12, 64)        0
# _________________________________________________________________
# conv2d_11 (Conv2D)           (None, 10, 10, 128)       73856
# _________________________________________________________________
# activation_13 (Activation)   (None, 10, 10, 128)       0
# _________________________________________________________________
# dropout_5 (Dropout)          (None, 10, 10, 128)       0
# _________________________________________________________________
# max_pooling2d_5 (MaxPooling2 (None, 5, 5, 128)         0
# _________________________________________________________________
# flatten_2 (Flatten)          (None, 3200)              0
# _________________________________________________________________
# dense_2 (Dense)              (None, 19)                60819
# _________________________________________________________________
# activation_14 (Activation)   (None, 19)                0
# =================================================================
# Total params: 181,235
# Trainable params: 181,235
# Non-trainable params: 0
# _________________________________________________________________
#
# # Evaluate on test data
# 1216/1 [================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================] - 1s 635us/sample - loss: 0.1823 - sparse_categorical_accuracy: 0.9293
# test loss, test acc: [0.3646695790788619, 0.9292763]
# Train on 95084 samples, validate on 28587 samples
# Epoch 1/20
# 95084/95084 [==============================] - 325s 3ms/sample - loss: 0.3915 - sparse_categorical_accuracy: 0.8749 - val_loss: 0.2022 - val_sparse_categorical_accuracy: 0.9418
# Epoch 2/20
# 95084/95084 [==============================] - 312s 3ms/sample - loss: 0.1208 - sparse_categorical_accuracy: 0.9628 - val_loss: 0.1526 - val_sparse_categorical_accuracy: 0.9516
# Epoch 3/20
# 95084/95084 [==============================] - 311s 3ms/sample - loss: 0.0917 - sparse_categorical_accuracy: 0.9718 - val_loss: 0.1146 - val_sparse_categorical_accuracy: 0.9663
# Epoch 4/20
# 95084/95084 [==============================] - 320s 3ms/sample - loss: 0.0779 - sparse_categorical_accuracy: 0.9751 - val_loss: 0.1256 - val_sparse_categorical_accuracy: 0.9599
# Epoch 5/20
# 95084/95084 [==============================] - 325s 3ms/sample - loss: 0.0653 - sparse_categorical_accuracy: 0.9793 - val_loss: 0.1213 - val_sparse_categorical_accuracy: 0.9646
# Epoch 00005: early stopping
# Model: "sequential_3"
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #
# =================================================================
# conv2d_12 (Conv2D)           (None, 32, 32, 32)        2432
# _________________________________________________________________
# activation_15 (Activation)   (None, 32, 32, 32)        0
# _________________________________________________________________
# conv2d_13 (Conv2D)           (None, 28, 28, 32)        25632
# _________________________________________________________________
# activation_16 (Activation)   (None, 28, 28, 32)        0
# _________________________________________________________________
# max_pooling2d_6 (MaxPooling2 (None, 14, 14, 32)        0
# _________________________________________________________________
# dropout_6 (Dropout)          (None, 14, 14, 32)        0
# _________________________________________________________________
# conv2d_14 (Conv2D)           (None, 12, 12, 64)        18496
# _________________________________________________________________
# activation_17 (Activation)   (None, 12, 12, 64)        0
# _________________________________________________________________
# conv2d_15 (Conv2D)           (None, 10, 10, 128)       73856
# _________________________________________________________________
# activation_18 (Activation)   (None, 10, 10, 128)       0
# _________________________________________________________________
# dropout_7 (Dropout)          (None, 10, 10, 128)       0
# _________________________________________________________________
# max_pooling2d_7 (MaxPooling2 (None, 5, 5, 128)         0
# _________________________________________________________________
# flatten_3 (Flatten)          (None, 3200)              0
# _________________________________________________________________
# dense_3 (Dense)              (None, 19)                60819
# _________________________________________________________________
# activation_19 (Activation)   (None, 19)                0
# =================================================================
# Total params: 181,235
# Trainable params: 181,235
# Non-trainable params: 0
# _________________________________________________________________
#
# # Evaluate on test data
# 1216/1 [================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================] - 1s 634us/sample - loss: 0.1484 - sparse_categorical_accuracy: 0.9400
# test loss, test acc: [0.2967110904645611, 0.9399671]
# Train on 95084 samples, validate on 28587 samples
# Epoch 1/20
# 95084/95084 [==============================] - 334s 4ms/sample - loss: 0.3658 - sparse_categorical_accuracy: 0.8832 - val_loss: 0.1877 - val_sparse_categorical_accuracy: 0.9428
# Epoch 2/20
# 95084/95084 [==============================] - 337s 4ms/sample - loss: 0.1195 - sparse_categorical_accuracy: 0.9631 - val_loss: 0.1358 - val_sparse_categorical_accuracy: 0.9568
# Epoch 3/20
# 95084/95084 [==============================] - 331s 3ms/sample - loss: 0.0910 - sparse_categorical_accuracy: 0.9712 - val_loss: 0.1416 - val_sparse_categorical_accuracy: 0.9558
# Epoch 4/20
# 95084/95084 [==============================] - 326s 3ms/sample - loss: 0.0751 - sparse_categorical_accuracy: 0.9758 - val_loss: 0.1218 - val_sparse_categorical_accuracy: 0.9620
# Epoch 5/20
# 95084/95084 [==============================] - 321s 3ms/sample - loss: 0.0621 - sparse_categorical_accuracy: 0.9805 - val_loss: 0.1015 - val_sparse_categorical_accuracy: 0.9690
# Epoch 6/20
# 95084/95084 [==============================] - 320s 3ms/sample - loss: 0.0533 - sparse_categorical_accuracy: 0.9828 - val_loss: 0.1135 - val_sparse_categorical_accuracy: 0.9637
# Epoch 7/20
# 95084/95084 [==============================] - 325s 3ms/sample - loss: 0.0505 - sparse_categorical_accuracy: 0.9838 - val_loss: 0.1214 - val_sparse_categorical_accuracy: 0.9659
# Epoch 00007: early stopping
# Model: "sequential_4"
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #
# =================================================================
# conv2d_16 (Conv2D)           (None, 32, 32, 32)        2432
# _________________________________________________________________
# activation_20 (Activation)   (None, 32, 32, 32)        0
# _________________________________________________________________
# conv2d_17 (Conv2D)           (None, 28, 28, 32)        25632
# _________________________________________________________________
# activation_21 (Activation)   (None, 28, 28, 32)        0
# _________________________________________________________________
# max_pooling2d_8 (MaxPooling2 (None, 14, 14, 32)        0
# _________________________________________________________________
# dropout_8 (Dropout)          (None, 14, 14, 32)        0
# _________________________________________________________________
# conv2d_18 (Conv2D)           (None, 12, 12, 64)        18496
# _________________________________________________________________
# activation_22 (Activation)   (None, 12, 12, 64)        0
# _________________________________________________________________
# conv2d_19 (Conv2D)           (None, 10, 10, 128)       73856
# _________________________________________________________________
# activation_23 (Activation)   (None, 10, 10, 128)       0
# _________________________________________________________________
# dropout_9 (Dropout)          (None, 10, 10, 128)       0
# _________________________________________________________________
# max_pooling2d_9 (MaxPooling2 (None, 5, 5, 128)         0
# _________________________________________________________________
# flatten_4 (Flatten)          (None, 3200)              0
# _________________________________________________________________
# dense_4 (Dense)              (None, 19)                60819
# _________________________________________________________________
# activation_24 (Activation)   (None, 19)                0
# =================================================================
# Total params: 181,235
# Trainable params: 181,235
# Non-trainable params: 0
# _________________________________________________________________
#
# # Evaluate on test data
# 1216/1 [================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================] - 1s 644us/sample - loss: 0.1261 - sparse_categorical_accuracy: 0.9515
# test loss, test acc: [0.25229122147029676, 0.95148027]
#
# Process finished with exit code 0
